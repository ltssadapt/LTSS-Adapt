<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Access Granted | LTSS Adapt</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 30px; text-align: center; }
    .box { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 0 15px rgba(0,0,0,0.1); max-width: 600px; margin: auto; }
    #chat { margin-top: 50px; background: #fff; padding: 20px; border-radius: 10px; max-width: 800px; margin-left: auto; margin-right: auto; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .message { margin-bottom: 12px; text-align: left; }
    .user { font-weight: bold; color: #1a1a1a; }
    .assistant { color: #444; }
    #inputArea { display: flex; gap: 10px; margin-top: 20px; }
    textarea { flex: 1; border-radius: 6px; border: 1px solid #ccc; padding: 10px; font-size: 1rem; }
    button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; }
  </style>
</head>
<body>
  <div class="box">
    <h2>‚úÖ Payment Verified</h2>
    <p>Thank you for subscribing to LTSS Adapt.</p>
    <p>Click the button below to access your tools.</p>
    <a href="#chat"><button>Access LTSS Adapt</button></a>
  </div>

  <div id="chat">
    <div id="messages">
      <div class="message assistant">ü§ñ Hi, I‚Äôm BuildBot. What LTSS tool, citation engine, or compliance page do you want to build?</div>
    </div>
    <div id="inputArea">
      <textarea id="userInput" rows="2" placeholder="Type your instruction..."></textarea>
      <button onclick="submitPrompt()">Send</button>
    </div>
  </div>

  <script>
    const OPENAI_API_KEY = 'your-api-key-here'; // Replace this with your real OpenAI key
    const ASSISTANT_ID = 'asst_Cz1bhb9DzCtrNdE7Jvz33Viu';

    async function submitPrompt() {
      const input = document.getElementById('userInput');
      const messages = document.getElementById('messages');
      const userText = input.value.trim();
      if (!userText) return;

      const userMsg = document.createElement('div');
      userMsg.className = 'message user';
      userMsg.textContent = `You: ${userText}`;
      messages.appendChild(userMsg);

      input.value = '';

      const assistantMsg = document.createElement('div');
      assistantMsg.className = 'message assistant';
      assistantMsg.textContent = 'BuildBot is generating your site code...';
      messages.appendChild(assistantMsg);

      messages.scrollTop = messages.scrollHeight;

      try {
        const threadRes = await fetch("https://api.openai.com/v1/threads", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${OPENAI_API_KEY}`
          }
        });
        const thread = await threadRes.json();

        await fetch(`https://api.openai.com/v1/threads/${thread.id}/messages`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${OPENAI_API_KEY}`
          },
          body: JSON.stringify({ role: "user", content: userText })
        });

        const runRes = await fetch(`https://api.openai.com/v1/threads/${thread.id}/runs`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${OPENAI_API_KEY}`
          },
          body: JSON.stringify({ assistant_id: ASSISTANT_ID })
        });

        const run = await runRes.json();
        let runStatus;
        do {
          await new Promise(res => setTimeout(res, 1500));
          const statusCheck = await fetch(`https://api.openai.com/v1/threads/${thread.id}/runs/${run.id}`, {
            headers: { Authorization: `Bearer ${OPENAI_API_KEY}` }
          });
          const runData = await statusCheck.json();
          runStatus = runData.status;
        } while (runStatus !== "completed");

        const finalRes = await fetch(`https://api.openai.com/v1/threads/${thread.id}/messages`, {
          headers: { Authorization: `Bearer ${OPENAI_API_KEY}` }
        });
        const finalData = await finalRes.json();
        const reply = finalData.data[0].content[0].text.value;

        assistantMsg.textContent = reply;
        messages.scrollTop = messages.scrollHeight;

      } catch (err) {
        assistantMsg.textContent = '‚ùå Error reaching BuildBot.';
        console.error(err);
      }
    }
  </script>
</body>
</html>


